<div class="analysis-container">
  <mat-card class="search-card">
    <mat-card-header>
      <mat-card-title>Topic Analysis</mat-card-title>
      <mat-card-subtitle>Enter a topic to analyze YouTube videos and news articles</mat-card-subtitle>
    </mat-card-header>
    
    <mat-card-content>
      <div class="search-section">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Enter topic to analyze</mat-label>
          <input matInput [formControl]="topicControl" placeholder="e.g., climate change, artificial intelligence">
        </mat-form-field>
        
        <button mat-raised-button color="primary" 
                (click)="startAnalysis()" 
                [disabled]="isLoading || !topicControl.value"
                class="analyze-btn">
          <mat-icon *ngIf="isLoading">refresh</mat-icon>
          <span *ngIf="isLoading">Analyzing...</span>
          <span *ngIf="!isLoading">Start Analysis</span>
        </button>
      </div>
      
      <div *ngIf="isLoading" class="loading-section">
        <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
      </div>
      
      <div *ngIf="statusMessage" class="status-message" 
           [ngClass]="{'success': statusMessage.includes('Success'), 'error': statusMessage.includes('error')}">
        <mat-icon>{{ statusMessage.includes('Success') ? 'check_circle' : 'error' }}</mat-icon>
        <span>{{ statusMessage }}</span>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Results section - only shown after successful analysis -->
  <div *ngIf="showResults" class="results-section">
    <mat-card class="results-card">
      <mat-card-header>
        <mat-card-title>Analysis Results for "{{ currentTopicName }}"</mat-card-title>
      </mat-card-header>
      
      <mat-card-content>
        <mat-tab-group (selectedTabChange)="onTabChange($event)" class="data-tabs">
          
          <!-- Videos Tab -->
          <mat-tab label="Videos">
            <div class="tab-content">
              <div *ngIf="videoLoading" class="loading-container">
                <mat-progress-spinner mode="indeterminate" diameter="40"></mat-progress-spinner>
                <p>Loading video data...</p>
              </div>
              
              <div *ngIf="!videoLoading">
                <div class="data-summary">
                  <h3>YouTube Videos ({{ videoData.length }})</h3>
                </div>
                
                <div class="table-container" *ngIf="videoData.length > 0">
                  <table mat-table [dataSource]="videoData" class="data-table">
                    
                    <ng-container matColumnDef="title">
                      <th mat-header-cell *matHeaderCellDef>Title</th>
                      <td mat-cell *matCellDef="let video" class="title-cell">
                        <a (click)="openLink(video.url)" class="video-link">{{ video.title }}</a>
                      </td>
                    </ng-container>
                    
                    <ng-container matColumnDef="publication_date">
                      <th mat-header-cell *matHeaderCellDef>Published</th>
                      <td mat-cell *matCellDef="let video">{{ video.publication_date | date:'short' }}</td>
                    </ng-container>
                    
                    <ng-container matColumnDef="channel_name">
                      <th mat-header-cell *matHeaderCellDef>Channel</th>
                      <td mat-cell *matCellDef="let video">{{ video.channel_name }}</td>
                    </ng-container>
                    
                    <ng-container matColumnDef="view_count">
                      <th mat-header-cell *matHeaderCellDef>Views</th>
                      <td mat-cell *matCellDef="let video">{{ video.view_count | number }}</td>
                    </ng-container>
                    
                    <ng-container matColumnDef="url">
                      <th mat-header-cell *matHeaderCellDef>Action</th>
                      <td mat-cell *matCellDef="let video">
                        <button mat-icon-button (click)="openLink(video.url)" matTooltip="Open video">
                          <mat-icon>open_in_new</mat-icon>
                        </button>
                      </td>
                    </ng-container>
                    
                    <tr mat-header-row *matHeaderRowDef="videoColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: videoColumns;" class="data-row"></tr>
                  </table>
                </div>
                
                <div *ngIf="videoData.length === 0" class="no-data">
                  <mat-icon>video_library</mat-icon>
                  <p>No video data found for this topic</p>
                </div>
              </div>
            </div>
          </mat-tab>
          
          <!-- Recent News Tab -->
          <mat-tab label="Recent News">
            <div class="tab-content">
              <div *ngIf="recentNewsLoading" class="loading-container">
                <mat-progress-spinner mode="indeterminate" diameter="40"></mat-progress-spinner>
                <p>Loading recent news...</p>
              </div>
              
              <div *ngIf="!recentNewsLoading">
                <div class="data-summary">
                  <h3>Recent News Articles ({{ recentNewsData.length }})</h3>
                </div>
                
                <div class="table-container" *ngIf="recentNewsData.length > 0">
                  <table mat-table [dataSource]="recentNewsData" class="data-table">
                    
                    <ng-container matColumnDef="headline">
                      <th mat-header-cell *matHeaderCellDef>Headline</th>
                      <td mat-cell *matCellDef="let article" class="title-cell">
                        <a (click)="openLink(article.url)" class="news-link">{{ article.headline }}</a>
                      </td>
                    </ng-container>
                    
                    <ng-container matColumnDef="publication_date">
                      <th mat-header-cell *matHeaderCellDef>Published</th>
                      <td mat-cell *matCellDef="let article">{{ article.publication_date | date:'short' }}</td>
                    </ng-container>
                    
                    <ng-container matColumnDef="source_name">
                      <th mat-header-cell *matHeaderCellDef>Source</th>
                      <td mat-cell *matCellDef="let article">{{ article.source_name }}</td>
                    </ng-container>
                    
                    <ng-container matColumnDef="url">
                      <th mat-header-cell *matHeaderCellDef>Action</th>
                      <td mat-cell *matCellDef="let article">
                        <button mat-icon-button (click)="openLink(article.url)" matTooltip="Read article">
                          <mat-icon>open_in_new</mat-icon>
                        </button>
                      </td>
                    </ng-container>
                    
                    <tr mat-header-row *matHeaderRowDef="recentNewsColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: recentNewsColumns;" class="data-row"></tr>
                  </table>
                </div>
                
                <div *ngIf="recentNewsData.length === 0" class="no-data">
                  <mat-icon>article</mat-icon>
                  <p>No recent news data found for this topic</p>
                </div>
              </div>
            </div>
          </mat-tab>
          
          <!-- Older News Tab -->
          <mat-tab label="Older News">
            <div class="tab-content">
              <div *ngIf="olderNewsLoading" class="loading-container">
                <mat-progress-spinner mode="indeterminate" diameter="40"></mat-progress-spinner>
                <p>Loading older news...</p>
              </div>
              
              <div *ngIf="!olderNewsLoading">
                <div class="data-summary">
                  <h3>Older News Articles ({{ olderNewsData.length }})</h3>
                </div>
                
                <div class="table-container" *ngIf="olderNewsData.length > 0">
                  <table mat-table [dataSource]="olderNewsData" class="data-table">
                    
                    <ng-container matColumnDef="headline">
                      <th mat-header-cell *matHeaderCellDef>Headline</th>
                      <td mat-cell *matCellDef="let article" class="title-cell">
                        <a (click)="openLink(article.url)" class="news-link">{{ article.headline }}</a>
                      </td>
                    </ng-container>
                    
                    <ng-container matColumnDef="publication_date">
                      <th mat-header-cell *matHeaderCellDef>Published</th>
                      <td mat-cell *matCellDef="let article">{{ article.publication_date | date:'short' }}</td>
                    </ng-container>
                    
                    <ng-container matColumnDef="source_name">
                      <th mat-header-cell *matHeaderCellDef>Source</th>
                      <td mat-cell *matCellDef="let article">{{ article.source_name }}</td>
                    </ng-container>
                    
                    <ng-container matColumnDef="url">
                      <th mat-header-cell *matHeaderCellDef>Action</th>
                      <td mat-cell *matCellDef="let article">
                        <button mat-icon-button (click)="openLink(article.url)" matTooltip="Read article">
                          <mat-icon>open_in_new</mat-icon>
                        </button>
                      </td>
                    </ng-container>
                    
                    <tr mat-header-row *matHeaderRowDef="olderNewsColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: olderNewsColumns;" class="data-row"></tr>
                  </table>
                </div>
                
                <div *ngIf="olderNewsData.length === 0" class="no-data">
                  <mat-icon>history</mat-icon>
                  <p>No older news data found for this topic</p>
                </div>
              </div>
            </div>
          </mat-tab>
          
        </mat-tab-group>
      </mat-card-content>
    </mat-card>
  </div>
</div>