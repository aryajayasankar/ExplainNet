<div class="topic-detail-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <p>Loading topic details...</p>
  </div>

  <!-- Topic Content -->
  <div *ngIf="!isLoading && topicData" class="topic-content">
    <!-- Header Section -->
    <div class="topic-header">
      <button mat-icon-button (click)="goBackToLocker()" class="back-button">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <div class="topic-info">
        <h1>{{topicData.topic_name}}</h1>
        <div class="topic-stats">
          <span class="stat-item">{{topicData.article_count}} Articles</span>
          <span class="stat-item">{{topicData.video_count}} Videos</span>
        </div>
      </div>
    </div>

    <!-- Tabbed Content -->
    <mat-tab-group class="topic-tabs">
      <mat-tab label="YouTube Analytics">
        <div class="tab-content">
          <!-- Channel Impact Scores -->
          <div class="analytics-section">
            <h2>Channel Impact Rankings</h2>
            <div class="channel-cards" *ngIf="channelAnalytics.length > 0">
              <mat-card class="channel-card" *ngFor="let channel of channelAnalytics.slice(0, 5)">
                <mat-card-header>
                  <mat-card-title>{{channel.channel_name}}</mat-card-title>
                  <mat-card-subtitle>Impact Score: {{channel.impact_score}}</mat-card-subtitle>
                </mat-card-header>
                <mat-card-content>
                  <div class="channel-stats">
                    <div class="stat">
                      <strong>{{channel.total_views | number}}</strong>
                      <span>Total Views</span>
                    </div>
                    <div class="stat">
                      <strong>{{channel.total_videos}}</strong>
                      <span>Videos</span>
                    </div>
                    <div class="stat">
                      <strong>{{channel.sentiment_analysis.overall_score | number:'1.1-1'}}%</strong>
                      <span>Sentiment</span>
                    </div>
                  </div>
                  <div class="sentiment-breakdown">
                    <span class="positive">+{{channel.sentiment_analysis.positive}}</span>
                    <span class="neutral">={{channel.sentiment_analysis.neutral}}</span>
                    <span class="negative">-{{channel.sentiment_analysis.negative}}</span>
                    <small>
                      {{channel.sentiment_analysis.analyzed_comments || channel.sentiment_analysis.english_comments}} analyzed 
                      / {{channel.sentiment_analysis.total_comments}} total
                    </small>
                  </div>
                  <div class="language-info" *ngIf="channel.sentiment_analysis.non_english_comments > 0">
                    <small>{{channel.sentiment_analysis.non_english_comments}} non-English comments detected</small>
                  </div>
                </mat-card-content>
              </mat-card>
            </div>
          </div>

          <!-- Views Timeline Chart -->
          <div class="analytics-section">
            <h2>Video Performance Timeline</h2>
            <mat-card class="chart-card">
              <mat-card-content>
                <canvas #timelineChart width="800" height="400"></canvas>
              </mat-card-content>
            </mat-card>
          </div>
        </div>
      </mat-tab>

      <mat-tab label="News Analytics">
        <div class="tab-content">
          <mat-card>
            <mat-card-header>
              <mat-card-title>News Source Analytics</mat-card-title>
              <mat-card-subtitle>{{topicData.article_count}} articles analyzed</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <p>Source reliability rankings, Guardian vs NewsAPI data, and fetch controls will appear here.</p>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>

      <mat-tab label="AI Insights">
        <div class="tab-content">
          <mat-card>
            <mat-card-header>
              <mat-card-title>Virality Prediction & Insights</mat-card-title>
              <mat-card-subtitle>ML-powered analysis</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <p>GNN virality scores, sentiment analysis, and topic modeling results will appear here.</p>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>

  <!-- Error State -->
  <div *ngIf="!isLoading && !topicData" class="error-container">
    <p>Topic not found.</p>
    <button mat-button (click)="goBackToLocker()">Back to Locker</button>
  </div>
</div>